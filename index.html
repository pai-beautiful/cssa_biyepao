<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ¯•ä¸šè¢é¢†å–æŸ¥è¯¢ç³»ç»Ÿ@HKBUCSSA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #002d72;
      color: white;
      padding: 1rem 2rem;
      font-size: 1.5rem;
    }
    .container {
      margin: 3rem auto;
      padding: 2rem;
      max-width: 600px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label, input, button {
      display: block;
      width: 100%;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    button {
      background-color: #002d72;
      color: white;
      border: none;
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background-color: #001a47;
    }
    .info {
      background: #e6f0ff;
      padding: 1rem;
      border-radius: 8px;
      display: none;
    }
    .info p {
      margin: 0.5rem 0;
    }
    .warning {
      color: red;
      font-weight: bold;
    }
    .record-section {
      margin-top: 2rem;
      background-color: #fffbe0;
      padding: 1rem;
      border-radius: 8px;
    }
    .record-section li button {
      float: right;
      background-color: crimson;
      margin-left: 1rem;
      font-size: 0.9rem;
      padding: 0.2rem 0.5rem;
    }
  </style>
</head>
<body>
  <header>CSSAæ¯•ä¸šè¢é¢†å–æŸ¥è¯¢</header>
  <div class="container">
    <label for="excelFile">ä¸Šä¼  Excel æ–‡ä»¶ï¼š</label>
    <input type="file" id="excelFile" accept=".xlsx">

    <label for="studentId">è¯·è¾“å…¥å­¦å·ï¼š</label>
    <input type="text" id="studentId" placeholder="ä¾‹å¦‚ï¼š24471690">
    <button onclick="searchStudent()">æŸ¥è¯¢</button>

    <div id="result" class="info"></div>
    <button id="markReceivedBtn" style="display:none" onclick="markAsReceived()">æ ‡è®°ä¸ºå·²é¢†å–</button>
    <button id="cancelReceivedBtn" style="display:none; background-color:crimson;" onclick="cancelReceived(currentId)">å–æ¶ˆæ ‡è®°é¢†å–</button>

    <div class="record-section">
      <h3>ğŸ“ å·²é¢†å–åå•</h3>
      <ul id="receivedList"></ul>
    </div>
  </div>

  <script>
    let studentData = {};
    let currentId = null;

    document.getElementById('excelFile').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet);
        studentData = {};
        json.forEach(row => {
          if (row['å­¦å·']) {
            const key = String(row['å­¦å·']).trim();
            studentData[key] = {
              åå­—: row['åå­—'],
              å­¦é™¢: row['å­¦é™¢'],
              ä¸“ä¸š: row['ä¸“ä¸š'],
              å­¦ä½: row['å­¦ä½'],
              å°ºç : row['å°ºç '],
              é¢œè‰²: row['é¢œè‰²']
            }
          }
        });
        alert('æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±æœ‰ ' + Object.keys(studentData).length + ' ä½åŒå­¦');
        updateReceivedList();
      };
      reader.readAsArrayBuffer(e.target.files[0]);
    });

    function searchStudent() {
      const id = document.getElementById('studentId').value.trim();
      const resultDiv = document.getElementById('result');
      currentId = id;
      const receivedList = JSON.parse(localStorage.getItem('received') || '[]');

      if (studentData[id]) {
        const data = studentData[id];
        let infoHTML = `
          <p><strong>åå­—ï¼š</strong> ${data.åå­—}</p>
          <p><strong>å­¦é™¢ï¼š</strong> ${data.å­¦é™¢}</p>
          <p><strong>ä¸“ä¸šï¼š</strong> ${data.ä¸“ä¸š}</p>
          <p><strong>å­¦å·ï¼š</strong> ${id}</p>
          <p><strong>å­¦ä½ï¼š</strong> ${data.å­¦ä½}</p>
          <p><strong>å°ºç ï¼š</strong> ${data.å°ºç }</p>
          <p><strong>é¢œè‰²ï¼š</strong> ${data.é¢œè‰²}</p>
        `;
        if (receivedList.includes(id)) {
          infoHTML += `<p class='warning'>âš ï¸ æ­¤å­¦å·å·²é¢†å–æ¯•ä¸šè¢</p>`;
          document.getElementById('cancelReceivedBtn').style.display = 'block';
        } else {
          document.getElementById('cancelReceivedBtn').style.display = 'none';
        }
        resultDiv.innerHTML = infoHTML;
        resultDiv.style.display = 'block';
        document.getElementById('markReceivedBtn').style.display = 'block';
      } else {
        resultDiv.innerHTML = `<p style="color:red;">æœªæ‰¾åˆ°è¯¥å­¦å·å¯¹åº”çš„ä¿¡æ¯ã€‚</p>`;
        resultDiv.style.display = 'block';
        document.getElementById('markReceivedBtn').style.display = 'none';
        document.getElementById('cancelReceivedBtn').style.display = 'none';
      }
    }

    function markAsReceived() {
      if (!currentId) return;
      let receivedList = JSON.parse(localStorage.getItem('received') || '[]');
      if (!receivedList.includes(currentId)) {
        receivedList.push(currentId);
        localStorage.setItem('received', JSON.stringify(receivedList));
        alert('âœ… å·²è®°å½•è¯¥åŒå­¦ä¸ºå·²é¢†å–');
        searchStudent();
        updateReceivedList();
      }
    }

    function cancelReceived(id) {
      let receivedList = JSON.parse(localStorage.getItem('received') || '[]');
      receivedList = receivedList.filter(item => item !== id);
      localStorage.setItem('received', JSON.stringify(receivedList));
      updateReceivedList();
      if (currentId === id) searchStudent();
    }

    function updateReceivedList() {
      const ul = document.getElementById('receivedList');
      ul.innerHTML = '';
      const receivedList = JSON.parse(localStorage.getItem('received') || '[]');
      receivedList.forEach(id => {
        const li = document.createElement('li');
        li.innerHTML = `${id} ${(studentData[id] ? ` - ${studentData[id].åå­—}` : '')} <button onclick="cancelReceived('${id}')">å–æ¶ˆ</button>`;
        ul.appendChild(li);
      });
    }

    updateReceivedList();
  </script>
</body>
</html>

